{% extends "base.html" %}

{% block title %}Harshit's Blog - Tech Insights & Code Adventures{% endblock %}
{% block description %}Exploring the intersection of systems, code, and curiosity. Join me on this journey through tech
adventures and deep insights.{% endblock %}

{% block styles %} {% endblock %}

{% block content %}
<section
  class="mb-12 text-center bg-slate-100 dark:bg-slate-800 p-8 rounded-xl border border-slate-200 dark:border-slate-700">
  <h1 class="text-4xl font-extrabold mb-2">Welcome to My Digital Garden üå±</h1>
  <p class="text-lg text-slate-600 dark:text-slate-400 max-w-2xl mx-auto">Exploring the intersection of systems, code,
    and curiosity. Join me on this journey through tech adventures and
    deep insights.</p>
</section>

<section aria-label="Filters" class="mb-8 flex flex-wrap items-center justify-center gap-2">
  <div class="flex flex-wrap items-center gap-2">
    <input
      class="w-full max-w-xs px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 focus:outline-none focus:ring-2 focus:ring-purple-500"
      id="client-search" type="search" placeholder="Search by title or summary‚Ä¶">
    <button
      class="px-4 py-2 rounded-full border border-slate-300 dark:border-slate-700 text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 transition"
      id="clear-filters" title="Clear filters">‚ôªÔ∏è Clear</button>
  </div>
  <div id="tag-chips" class="flex flex-wrap items-center gap-2"></div>
</section>

{% if posts %}
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="postsGrid">
  {% for post in posts %}
  <a href="/BLOGS/{{ post.slug }}.html"
    class="block p-6 rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-md hover:shadow-lg transition-all"
    data-title="{{ post.title|lower }}" data-summary="{{ (post.summary or '')|lower }}"
    data-tags="{{ (post.tags or [])|join(',')|lower }}">
    <h2 class="text-xl font-bold mb-2">{{ post.title }}</h2>
    {% if post.summary %}<p class="text-slate-600 dark:text-slate-400 text-sm mb-4">{{ post.summary }}</p>{% endif %}
    <div class="flex justify-between items-center text-sm text-slate-500 dark:text-slate-400">
      <span class="flex items-center gap-1">üìÖ {{ post.date }}</span>
      {% if post.tags %}
      <div class="flex flex-wrap gap-1">
        {% for tag in post.tags %}<span
          class="text-xs px-2 py-1 rounded-full bg-slate-200 dark:bg-slate-700 text-slate-600 dark:text-slate-400">{{
          tag }}</span>{% endfor %}
      </div>
      {% endif %}
    </div>
  </a>
  {% endfor %}
</div>
{% else %}
<div class="text-center p-12 text-slate-500 dark:text-slate-400">
  <h2 class="text-2xl font-bold mb-2">Coming Soon‚Ä¶</h2>
  <p>I'm working on some amazing content. Check back soon! üöÄ</p>
</div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
  // ===== Build Tag Chips from rendered cards =====
  const cards = [...document.querySelectorAll('.post-card')];
  const allTags = new Set();
  cards.forEach(card => (card.dataset.tags || '').split(',').filter(Boolean).forEach(t => allTags.add(t.trim())));

  const tagWrap = document.getElementById('tag-chips');
  const makeChip = (label) => {
    const b = document.createElement('button');
    b.className = 'chip'; b.textContent = `# ${label}`; b.setAttribute('aria-pressed', 'false');
    b.dataset.tag = label;
    b.addEventListener('click', () => {
      const active = b.getAttribute('aria-pressed') === 'true';
      b.setAttribute('aria-pressed', String(!active));
      filter();
    });
    return b;
  };
  [...allTags].sort().forEach(t => tagWrap.appendChild(makeChip(t)));

  // ===== Text search across title + summary =====
  const searchInputs = [document.getElementById('client-search'), ...(window.__globalSearchInputs || [])].filter(Boolean);
  searchInputs.forEach(inp => inp.addEventListener('input', () => filter()));

  // ===== Clear =====
  document.getElementById('clear-filters').addEventListener('click', () => {
    searchInputs.forEach(i => i.value = '');
    tagWrap.querySelectorAll('.chip[aria-pressed="true"]').forEach(c => c.setAttribute('aria-pressed', 'false'));
    filter();
  });

  function filter() {
    const q = (searchInputs.find(i => i.value)?.value || '').trim().toLowerCase();
    const activeTags = [...tagWrap.querySelectorAll('.chip[aria-pressed="true"]')].map(c => c.dataset.tag);
    let visibleCount = 0;
    cards.forEach(card => {
      const hay = `${card.dataset.title} ${card.dataset.summary}`;
      const tagList = (card.dataset.tags || '').split(',').filter(Boolean);
      const matchesText = !q || hay.includes(q);
      const matchesTags = !activeTags.length || activeTags.every(t => tagList.includes(t));
      const show = matchesText && matchesTags;
      card.style.display = show ? '' : 'none';
      if (show) visibleCount++;
    });
    // Could display "no results" message if visibleCount == 0
  }
</script>
{% endblock %}