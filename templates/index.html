{% extends "base.html" %}

{% block title %}Harshit's Blog - Tech Insights & Code Adventures{% endblock %}

{% block styles %}
<link rel="stylesheet" href="/BLOGS/static/styles/index.css">
{% endblock %}

{% block content %}
<section class="hero">
  <h1>Welcome to My Digital Garden üå±</h1>
  <p>Exploring the intersection of systems, code, and curiosity. Join me on this journey through tech adventures and
    deep insights.</p>
</section>

<section class="controls" aria-label="Filters">
  <div class="filter-bar">
    <input class="filter-input" id="client-search" type="search" placeholder="Search by title or summary‚Ä¶">
    <button class="chip" id="clear-filters" title="Clear filters">‚ôªÔ∏è Clear</button>
  </div>
  <div id="tag-chips" class="filter-bar"></div>
</section>

{% if posts %}
<div class="posts-grid" id="postsGrid">
  {% for post in posts %}
  <a href="/BLOGS/{{ post.slug }}.html" class="post-card" data-title="{{ post.title|lower }}"
    data-summary="{{ (post.summary or '')|lower }}" data-tags="{{ (post.tags or [])|join(',')|lower }}">
    <h2 class="post-title">{{ post.title }}</h2>
    {% if post.summary %}<p class="post-summary">{{ post.summary }}</p>{% endif %}
    <div class="post-meta">
      <span class="post-date">üìÖ {{ post.date }}</span>
      {% if post.tags %}
      <div class="post-tags">
        {% for tag in post.tags %}<span class="tag">{{ tag }}</span>{% endfor %}
      </div>
      {% endif %}
    </div>
  </a>
  {% endfor %}
</div>
{% else %}
<div class="no-posts">
  <h2>Coming Soon‚Ä¶</h2>
  <p>I'm working on some amazing content. Check back soon! üöÄ</p>
</div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
  // ===== Build Tag Chips from rendered cards =====
  const cards = [...document.querySelectorAll('.post-card')];
  const allTags = new Set();
  cards.forEach(card => (card.dataset.tags || '').split(',').filter(Boolean).forEach(t => allTags.add(t.trim())));

  const tagWrap = document.getElementById('tag-chips');
  const makeChip = (label) => {
    const b = document.createElement('button');
    b.className = 'chip'; b.textContent = `# ${label}`; b.setAttribute('aria-pressed', 'false');
    b.dataset.tag = label;
    b.addEventListener('click', () => {
      const active = b.getAttribute('aria-pressed') === 'true';
      b.setAttribute('aria-pressed', String(!active));
      filter();
    });
    return b;
  };
  [...allTags].sort().forEach(t => tagWrap.appendChild(makeChip(t)));

  // ===== Text search across title + summary =====
  const searchInputs = [document.getElementById('client-search'), ...(window.__globalSearchInputs || [])].filter(Boolean);
  searchInputs.forEach(inp => inp.addEventListener('input', () => filter()));

  // ===== Clear =====
  document.getElementById('clear-filters').addEventListener('click', () => {
    searchInputs.forEach(i => i.value = '');
    tagWrap.querySelectorAll('.chip[aria-pressed="true"]').forEach(c => c.setAttribute('aria-pressed', 'false'));
    filter();
  });

  function filter() {
    const q = (searchInputs.find(i => i.value)?.value || '').trim().toLowerCase();
    const activeTags = [...tagWrap.querySelectorAll('.chip[aria-pressed="true"]')].map(c => c.dataset.tag);
    let visibleCount = 0;
    cards.forEach(card => {
      const hay = `${card.dataset.title} ${card.dataset.summary}`;
      const tagList = (card.dataset.tags || '').split(',').filter(Boolean);
      const matchesText = !q || hay.includes(q);
      const matchesTags = !activeTags.length || activeTags.every(t => tagList.includes(t));
      const show = matchesText && matchesTags;
      card.style.display = show ? '' : 'none';
      if (show) visibleCount++;
    });
    // Could display "no results" message if visibleCount == 0
  }
</script>
{% endblock %}